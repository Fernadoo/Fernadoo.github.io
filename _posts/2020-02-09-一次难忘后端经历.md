---
layout:     post
title:      一次难忘的后端经历
subtitle:   一切都要从Dengji Zhao要我们做一个小程序开始
date:       2020-02-09
author:     Fernando
header-img: img/200209/post-bg-unix-linux.jpg
catalog: true
tags:
    - 开发技巧
    - Linux
    - 服务器
---

> 大致分为：服务器的基础配置，基于conda的多用户环境，https协议的开通其中最后一项细分为ssl证书的安装和Apache的转发代理。试用于macOs，Ubuntu。

### I. 服务器的基础配置

```shell
# --- 本地端 ---

# 生成密钥公钥 公钥copy至server端.ssh/authorized_keys
$ ssh-keygen -t rsa -C "email@qwerty.com"
$ cat .ssh/id_rsa.pub

# --- 移步至server端 ---

# 查看server系统位数
$ getconf LONG_BIT

# 查看本节点ip
$ hostname -I

# 普通用户登陆后 切换至root
$ sudo -i

# 关闭ssh密码访问 关闭root直接登陆
$ vim /etc/ssh/sshd_config
# 将 PasswordAuthentication yes 改为 PasswordAuthentication no
# 将 PermitRootLogin yes 改为 PermitRootLogin no
# 重启ssh服务
$ service sshd restart

# 添加用户 -m是建立家目录
$ useradd -m {user_name}

# 配置密码
$ passwd {user_name}

# 删除用户 （连带家目录）
$ userdel -r {user_name}

# 查看可用系统shell 查看新用户当前shell 切换至新shell, e.g. bash
$ echo $SHELL
$ cat /etc/passwd | grep {user_name}
$ chsh -s /bin/bash {user_name}

# 查看防火墙状态 开启、关闭防火墙
$ ufw status [verbose]
$ ufw enable
$ ufw disable

# 查看防火墙目前允许应用 查看详细应用信息 添加新规则 
$ ufw app list
$ ufw app info '{app_name}'
$ ufw allow {new_app_name}

# 防火墙允许某端口访问
$  /sbin/iptables -A INPUT -p TCP --sport 443 -j ACCEPT

# 后台运行某命令并将输入重定向至log文件
$ nohup {command} >> {log_file} &

# 查看某端口下进程
$ lsof -i:{port_number}

# 查看相关进程
$ ps -ef | grep {key_words}
```

### II. 基于conda的多用户环境

```shell
# 下载anaconda 并安装
$ wget {anaconda_sh_file_url}
$ sh ./{anaconda_sh_file}

# root用户 指定安装路径为`/opt/anaconda`
# 个人用户 指定安装路径为家目录任意位置
# init conda in ~/.bashrc [yes]
# root用户再将~/.bashrc中init conda的部分copy至/etc/profile
# base环境只有root可写

# 安装jupyterHub和相应的包管理器 
# 目前最新版anaconda支持python37但jupyterHub支持python38，冲突
$ conda install jupyterhub
$ conda install nb_conda_kernels

# conda新建、查看、激活、退出、删除虚拟环境
$ conda create -n {env_name} python={py_version}
$ conda env list
$ conda activate {env_name}
$ conda deactivate {env_name}
$ conda remove -n {env_name} --all

# 配置多kernal的jupyter notebook
$ conda install ipykernel
$ ipython kernel install --user --name={kernal_name}

# 配置jupyter notebook密码
$ jupyter notebook --generate-config
$ ipython
In [1]: from notebook.auth import passwd
In [2]: passwd()
Enter password:
Verify password:
Out[2]: '{hash_code}'
$ vim /home/zhufm/.jupyter/jupyter_notebook_config.py
# c.NotebookApp.password = u'{hash_code}'

# 启动jupyter 监听所有ip
# notebook_url+/lab = jupyter_lab
$ jupyter notebook --ip 0.0.0.0 --port {port_number} --no-browser
```

### III. Https协议的开通

##### 1. ssl证书的安装 

##### 2. Apache转发代理



---

References

1. https://hkumockup.wixsite.com/14200-01/using-the-gpu-farm
2. 10.15.89.41:8899 [inside ShanghaiTech]
3. https://zhuanlan.zhihu.com/p/66169551

